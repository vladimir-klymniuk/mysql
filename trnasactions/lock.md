# Взаимоблокировки

```r
    Взаимоблокировка происходит, когда две или более транзакции запрашивают блокировку одних и тех же ресурсов, 
    в результате чего образуется циклическая зависимость. Они также возникают в случае, если тразакции пытаются заблокировать 
    ресурсы в разном порядке. Взаимоблокировки могут происходить, когда несколько транзакций блокируют одни и те же ресурсы. Рассмотрим в качестве примера следующие две транзакции, обращабщиеся к таблице StockPrice:
```
```sql
    START TRANSACTION
    UPDATE StockPrice SET close = 45.50 WHERE stock_id = 4 and date = '2002-05-01';
    UPDATE StockPrice SET close = 19.80 WHERE stock_id = 3 and date = '2002-05-02';
    COMMIT;
```

```sql
    START TRANSACTION;
    UPDATE StockPrice SET high = 20.12 WHERE stock_id = 3 and date = '2002-05-02';
    UPDATE StockPrice SET hugh = 47.20 WHERE stock_id = 4 and date = '2002-05-01;
    COMMIT;
```

Если вам не повезет, то каждая транзакция выполнит первый запрос и обновит строку данных, заблокировав ее в процессе обновления. 
Затем обе транзакции попытаются обновить вторую строку, но обнаружат, что она уже заблокирована. 
В результате одна транзакция будет до бесконечности ожидать окончание другой, и конфликт не разрешится до тех пор, пока не произойдет какое-то событие, которое снимает взаимную блокировку. Взаимоблокировку нельзя разрешить без отката одной из транзакйиц, частичного или полного.