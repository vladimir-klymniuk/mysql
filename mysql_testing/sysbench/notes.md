sysbench

С помощью инструмента `sysbench` можно запускать различные эталонные тесты. Он был разработан для
тестирования не только производительности базы данных, но и того, насколько хорошо работает система как
сервер баз данных. Мы начнем с некоторых тестов, которые не являются специфичными для MySQL и измеряют производительность, подсистем, определяющих общие ограничения системы. Затем мы покажем, как измерять производительность СУБД.

Эталонное тестирование процессора с помощью инструмента `sysbench`

Наиболее очевидным тестом подсистемы является эталонный тест процессора, в котором используются 64-разрядные целые числа для вычисления простых чисел до указанного максимума. Мы можем запустить этот тест на двух серверах, каждый под укравлением `GNU/Linux`, и сравнить результаты. 

Вот характеристики оборудования сервера данных:
```bash
    cat /proc/cpuinfo
```

Тест производительности:
```bash
    sysbench --test-cpu --cpu-max-prime=20000 run
```

Эталонное тестирование файлового ввода/вывода с помощью инструмента sysbench.

Эталонный тест `fileio` измеряет параметры работы операционной системы при различных нагрузка ввода/вывода. Он очень полезе для сравнения жестиких дисков, RAID-контроллеров и режимов RAID, а также
для настройки подситемы ввода/вывода.

Первым шагом при выполнении этого теста является подготовка нескольких файлов. Вам нужно сгенерировать значительно больше данных. чем помещается в память. Если данные загрузятся в память, операционная система будет кэшировать большую их часть, а результаты не совсем точно отразят нагрузку на подсистему ввода/вывода. Начнем с создания набора данных:

```bash
    sysbench --test=fileio --file-total-size=150G prepare
```

Вторым шагом является запуск теста. Для тестирования производительности при различных типах
нагрузки на систему ввода/вывода используются следующие параметры:

seqwr
    Последовательная запись
seqrewr
    Последовательная перезапись
seqrd
    Последовательное чтение
rndrd
    Произвольная запись
rndwr
    Произвольное чтение
rndrw
    Произвольное чтение в сочетании с произвольной записью

Следующая команда запускает тест ввода/вывода с произвольным чтением/записью:

```bash
    sysbench --test=fileio --file-total-size=150G --file-test-mode=rndrw --nit-rng=on --max-time=300 --max-requests=0 run
```

Результат работы команды содержит большое количество информации. 
Наиболее интересны для настройки подсистемы ввода/вывода "количество запросов в секунду(RPS) и общая 
пропускная способность (Mb/sec)."

Закончив тест, можно удалить файлы, которые программа sysbench создала для тестирования:
```
    sysbench --test=fileio --file-total-size=150G cleanup
```

Эталонное тестирование `OLTP-системы` с помощью инструмента `sysbench`.

Эталонное тестирование системы оперативной обработки транзакций
(OLTP) эмулирует рабочую нагрузку, характерную для обработки транзакций. Мы приведем
пример такого тестирования для таблицы, содержащей миллион строк. 
Первым шагом является подготовка самой таблицы, на которой будет выполняться тестирование:

```
    sysbench --test=oltp --oltp-table-size=1000000 --mysql-db=test --mysql-urser=root prepare
```

Это все, что нужно сделать для подготовки тестовых данных. Затем мы запускаем тест в режиме чтения на 60 секунд
с 8 одновременно работающими потоками:

```
    sysbench --test=oltp --oltp-table-size=10000000 --mysql-db=test --mysql-user=root --max-time=60
    --oltp-read-only=on --max-request=0 --num-threads=8
```

Как и раньше, в полученных нами результатах содержится очень много информации.
Наибольший интерес представляют следующие данные:

    - Счётчик транзакций 
    - Количество транзакций в секунду
    - Статистика по запросам (минимальное, среднее, максимальное время и 95-й процентиль)
    - Статистика по равномерности загрузки потоков, которая показывает, насколько справедливо
      распредилялась между ними эмулированная нугрузка.


Другие возможности инструмента sysbench

Инструмент `sysbench` может запускать несколько других эталонных тестов системы,
которые непосредственно не измеряют производительность СУБД. Среди них:
```
memory
    Выполняет последовательные операции чтения/записи в памяти.
```

```
threads
    Тестирует производительность планировщика потоков. Особенно полезно
    тестировать поведение планировщика при высоких нагрузках.
```

```
mutex
    Измеряет производительность работы мьютексов, эмулируя ситуацию,
    когда все потоки большую часть времени работают параллельно, захватывая мьютек
```

```
seqwr
    Измеряет производительность последовательной записи (один из типов нагрузки в режиме
    тестирования fileio). Это очень важно для тестирования практических пределов
    производительности системы. Тест показывает, насколько хорошо работает кэш
    RAID-контроллера, и предупреждает, если результаты оказываются необычными.
    Например, если отсутствует кэш записи с резервным батарейным питанием, 
    а диск обрабатывает 3000 запросов в секунду, то что-то идет не так
    и вашими данными определенно угрожает опасность.
```

```
Кроме параметра. задающего режим тестирования (--test), инструмент `sysbench` принимает
и некоторые другие общие параметры, например '--num-threads', '--max-requests' и '--maxtime'.
```